<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>main.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/EmbryoViewer.html">EmbryoViewer</a></li>
                                <li><a href="../classes/SpcimenView.html">SpcimenView</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: main.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
//goog.require(&#x27;X.labelmap&#x27;);

//The initail script that creates the views

//TODO: sync zooming
//



//window.addEventListener(&#x27;load&#x27;, function() {
//               
//    return;  // Remove for testing on local chrome app
//    
//    // So we can just use index.html instead of deploying the web app
//    var CHROME_ID = &#x27;dndfpjnjfpbnpoeocbdgimhfcombnfhj&#x27;;
//    var IMAGE_SERVER = &#x27;chrome-extension://&#x27; + CHROME_ID; 
//
//    var wildtypes = 
//            [&#x27;20131206_MLLT3_15.3_d_WT_rec_28um.nrrd&#x27;,
//             &#x27;/20140121RIC8B_15.4_b_wt_rec_28um.nrrd&#x27;,
//             &#x27;/20140128_SMOC1_18.2_c_wt_rec_28um.nrrd&#x27;];
//    var mutants = 
//            [&#x27;/20140128_SMOC1_18.2_c_wt_rec_28um.nrrd&#x27;,
//             &#x27;/20131206_MLLT3_15.3_d_WT_rec_28um.nrrd&#x27;,
//             &#x27;/20140121RIC8B_15.4_b_wt_rec_28um.nrrd&#x27;];
//
//
//    var div = &#x27;viewer&#x27; // For developing outside of web app
//    dcc.EmbryoViewer(wildtypes, mutants, div, IMAGE_SERVER);
//
//});


(function () {
    if (typeof dcc === &#x27;undefined&#x27;)
        dcc = {};
    
   
 
     dcc.EmbryoViewer = function(data, div, queryColonyId) {
         /**
          * @class EmbryoViewer
          * @type String
          */
        
        var IMAGE_SERVER = &#x27;https://www.mousephenotype.org/images/emb/&#x27;;
        var WILDTYPE_COLONYID = &#x27;baseline&#x27;;
        var wildtypes = [];
        var mutants = [];
        var queryColonyId = queryColonyId;
        var horizontalView = undefined;
     
        if (data[&#x27;success&#x27;]){
            // Get the baselines and the mutant paths
            for(var i = 0; i &lt; data.volumes.length; i++) {

                var obj = data.volumes[i];

                 if (obj.colonyId === WILDTYPE_COLONYID){
                    wildtypes.push(buildUrl(obj));

                }else{
                    mutants.push(buildUrl(obj));   
                }
            }
            
        }else{
            //Just display a message informing no data
            var data = {colonyId: queryColonyId};
            var source   = $(&quot;#no_data_template&quot;).html();
            var template = Handlebars.compile(source);
            $(&#x27;#&#x27; + div).append(template(data));
        }
       
    
        var container = div;
        var views = [];
        
        var ortho = {
            // Visible: for the orthogonal views buttons
            // Linked: are the corresponding ortho views from the different specimens linked
            &#x27;X&#x27;: {
                visible: true,
                linked: true,
            },
            &#x27;Y&#x27;: {
                visible: true,
                linked: true,
            },
            &#x27;Z&#x27;: {
                visible: true,
                linked: true,
            }
        };
    
    
        function buildUrl(data){
            url = IMAGE_SERVER + data.cid + &#x27;/&#x27; 
                    + data.lid + &#x27;/&#x27; 
                    + data.gid + &#x27;/&#x27; 
                    + data.sid + &#x27;/&#x27; 
                    + data.pid + &#x27;/&#x27; 
                    + data.qid + &#x27;/&#x27; 
                    + data.url;

            return url;
        }
    
    
        function loadViewers(container) {

            views.push(dcc.SpecimenView(wildtypes, &#x27;wt&#x27;, container, WILDTYPE_COLONYID, sliceChange));
            views.push(dcc.SpecimenView(mutants, &#x27;mut&#x27;, container, queryColonyId, sliceChange));
        };
        
        
        
        function sliceChange(id, orientation, index) {
            //Listens to the slice change events from the viewers, and calls the
            // other specimen view if required

            for (var i = 0; i &lt; views.length; i++) {
                if (views[i].id === id) continue; //this is the views that changed
                
                if (orientation === &#x27;X&#x27; &amp;&amp; ortho[&#x27;X&#x27;].linked) {
                    views[i].setXindex(index);
                
                } else if (orientation === &#x27;Y&#x27; &amp;&amp; ortho[&#x27;Y&#x27;].linked) {
                    views[i].setYindex(index);
                
                } else if (orientation === &#x27;Z&#x27; &amp;&amp; ortho[&#x27;Z&#x27;].linked) {
                    views[i].setZindex(index);
                }
            }
        }
        
        
        function linkViews(orthoView, isLink){
            //OrthoView -&gt; &#x27;X&#x27;, &#x27;Y&#x27;, or &#x27;Z&#x27;
            
            // Change check or uncheck the correpsonding views checkboxes
            // And work out the offset, if any
            var wtIdx;
            var mutIdx;
         
            $(&#x27;.&#x27; + orthoView).prop(&#x27;checked&#x27;, isLink);
            
            ortho[orthoView].linked = isLink;
            
            for (var i = 0; i &lt; views.length; i++) {
                // Set/unset the link buttons
                if(views[i].id === &#x27;wt&#x27;){
                    wtIdx = views[i].getIndex(orthoView);
                }else if (views[i].id === &#x27;mut&#x27;){
                    mutIdx = views[i].getIndex(orthoView);
                }
            }
            for (var i = 0; i &lt; views.length; i++) {
                if (views[i].id === &#x27;mut&#x27;){
                    views[i].setIdxOffset(orthoView, wtIdx - mutIdx);
                }
            }  
        }
        
        

        function attachEvents() {
      
            $(&quot;.linkCheck&quot;).change(function(e){
              
                if ($(e.target).hasClass(&#x27;X&#x27;)) {
                    linkViews(&#x27;X&#x27;, e.currentTarget.checked);
                }
                else if ($(e.target).hasClass(&#x27;Y&#x27;)) {
                    linkViews(&#x27;Y&#x27;, e.currentTarget.checked);
                }
                else if ($(e.target).hasClass(&#x27;Z&#x27;)) {
                    linkViews(&#x27;Z&#x27;, e.currentTarget.checked);
                }
                        
            }.bind(this)); 
             
           
            
            // Hide/show slice views from the checkboxes
            $(&#x27;.toggle_slice&#x27;).change(function () {

                var slice_list = [&#x27;X_check&#x27;, &#x27;Y_check&#x27;, &#x27;Z_check&#x27;];	//IDs of the checkboxes
                var count = 0;

                //Count the number of checked boxes so we can work out a new width
                for (var i = 0; i &lt; slice_list.length; i++) {
                    if ($(&#x27;#&#x27; + slice_list[i]).is(&#x27;:checked&#x27;)) {
                        ortho[slice_list[i].charAt(0)].visible = true;
                        count++;
                    }
                    else {
                        ortho[slice_list[i].charAt(0)].visible = false;
                    }
                }
                for (var i = 0; i &lt; views.length; i++) {
                    views[i].setVisibleViews(ortho, count, horizontalView);
                }
                window.dispatchEvent(new Event(&#x27;resize&#x27;)); 

            });
            

            $(&quot;.button&quot;).button();
            


            
            $(&quot;#viewHeightSlider&quot;).tooltip({
                content: &quot;Modify slice viewer height&quot;,
                 show: {delay: 1200 }
            });

            $(&quot;#viewHeightSlider&quot;)
                    .slider({
                        min: 200,
                        max: 1920,
                        values: [500],
                        slide: $.proxy(function (event, ui) {
                            $(&#x27;.sliceWrap&#x27;).css(&#x27;height&#x27;, ui.value);
                            var evt = document.createEvent(&#x27;UIEvents&#x27;);
                            evt.initUIEvent(&#x27;resize&#x27;, true, false,window,0);
                            window.dispatchEvent(evt);
                        }, this)
                    });

            $(&#x27;.windowLevel&#x27;).tooltip({content: &quot;Adjust brightness/contrast&quot;,
                 show: {delay: 1200 }
             });
             
            $(&quot;#selectorWrap_wt&quot;).tooltip({content: &quot;Select WT embryo to view&quot;,
             show: {delay: 1200 }});
         
            $(&quot;#selectorWrap_mut&quot;).tooltip({content: &quot;Select mutant embryo to view&quot;,
             show: {delay: 1200 }});
         
         
  
        
    }//AttachEvents
    
    

    
    
    function setupOrientationControls(){
                
            // No orientation controls for single specimen view  
            if (wildtypes.length &lt; 1 || mutants.length &lt; 1){
                 $(&quot;#orientation_radio&quot; ).hide();
                 return;
            }
         
            $(&quot;#orientation_radio&quot; ).buttonset();
           
        
            $(&quot;#vertical_check&quot;)
                .click(function (event) {
                    horizontalView = true;
                   $(&#x27;.specimen_view&#x27;).css({
                       float: &#x27;left&#x27;,
                       width: &#x27;48%&#x27;,
                       clear: &#x27;none&#x27;
                       
                });
                $(&#x27;.sliceWrap&#x27;).css({
                       width: &#x27;100%&#x27;
                });
                $(&#x27;#horizontal_check&#x27;).prop(&#x27;checked&#x27;, true).button(&quot;refresh&quot;);
                window.dispatchEvent(new Event(&#x27;resize&#x27;)); 
        }.bind(this));
        
        $(&#x27;#horizontal_check&#x27;)
                .click(function (event) {
                    horizontalView = false;
                    var numVisible = 0;
                    for(var item in ortho){
                        if(ortho[item].visible) ++ numVisible;
                    }
                      
                $(&#x27;.specimen_view&#x27;).css({
                       float: &#x27;none&#x27;,
                       width: &#x27;100%&#x27;,
                       clear: &#x27;both&#x27;
                       
                });
                $(&#x27;.sliceWrap&#x27;).css({
                       width: String(100 / numVisible) + &#x27;%&#x27;
                      
                });
                $(&#x27;#vertical_check&#x27;).prop(&#x27;checked&#x27;, true).button(&quot;refresh&quot;);
                window.dispatchEvent(new Event(&#x27;resize&#x27;)); 
                
           
        }.bind(this));
        }
  

    // Style the control buttons

    $(function () {
       
        $(&quot;.toggle_slice&quot;).button();
        
                
        $( &quot;#help_link&quot; ).button({
             icons: {
                 primary: &#x27;ui-icon-help&#x27;
             }
        }).click(function(){
            //Get link to the docs
        }).css({width: &#x27;30&#x27;});
    });

//    $(&#x27;body&#x27;).bind(&#x27;beforeunload&#x27;, function () {
//        console.log(&#x27;bye&#x27;);
//    });
    
    loadViewers(container);
    attachEvents();
    setupOrientationControls();
    }//EmbryoViewer
     
   
    
})();

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
